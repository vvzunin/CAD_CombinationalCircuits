# Hacking

Вот несколько советов, которые помогут вам создать и протестировать этот проект в качестве разработчика и потенциального участника.

## Режим разработчика

Цели системы сборки, которые полезны только для разработчиков этого проекта, скрыты, если опция `CircuitGen_Generator_DEVELOPER_MODE` отключена. Включение этой опции делает доступными тесты и другие цели и параметры разработчика. Если вы не включите эту опцию, вы являетесь потребителем этого проекта и, следовательно, вам не нужны эти цели и параметры.

Режим разработчика всегда включен в рабочих процессах CI.

### Пресеты

В этом проекте используются [пресеты][1] для упрощения процесса настройки проекта. Как разработчику вам рекомендуется всегда устанавливать [последнюю версию CMake][2], чтобы использовать последние дополнения качества жизни.

У вас есть несколько вариантов передачи `CircuitGen_Generator_DEVELOPER_MODE` в команду настройки, но в этом проекте предпочитают использовать пресеты.

Как разработчик, вы должны создать файл `CMakeUserPresets.json` в корне проекта:

```json
{
  "version": 2,
  "cmakeMinimumRequired": {
    "major": 3,
    "minor": 14,
    "patch": 0
  },
  "configurePresets": [
    {
      "name": "dev",
      "binaryDir": "${sourceDir}/build/dev",
      "inherits": ["dev-mode", "ci-<os>"],
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug"
      }
    }
  ],
  "buildPresets": [
    {
      "name": "dev",
      "configurePreset": "dev",
      "configuration": "Debug"
    }
  ],
  "testPresets": [
    {
      "name": "dev",
      "configurePreset": "dev",
      "configuration": "Debug",
      "output": {
        "outputOnFailure": true
      }
    }
  ]
}
```

Вам следует заменить `<os>` в новом файле настроек на имя вашей операционной системы, которая может быть `win64`, `linux` или `darwin`. Вы можете увидеть, чему они соответствуют, в файле [`CMakePresets.json`](CMakePresets.json).

`CMakeUserPresets.json` также является идеальным местом, куда вы можете поместить все, что в противном случае вы хотели бы передать команде configure в терминале.

> **Примечание**
> Некоторые редакторы довольно жадны в открытии проектов с пресетами.
> Некоторые просто случайно выбирают пресет и начинают настраивать без вашего согласия,
> что может сбить с толку. Убедитесь, что Ваш редактор настраивается, когда Вам
> на самом деле этого хочется, например, в CLion Вам нужно убедиться, что только
> в `dev-dev preset` установлен флажок `Включить профиль`
> `Файл > Настройки... > Сборка, выполнение, развертывание > CMake` и в Visual Studio
> Вам необходимо установить опцию «Никогда не запускать шаг настройки автоматически»
> в `Инструменты > Параметры > CMake` **до открытия проекта**, после чего
> Вы можете настроить вручную, используя «Проект > Настроить кэш».

### Настройка, сборка и тестирование

Если Вы следовали приведенным выше инструкциям, то Вы можете настроить, собрать и протестировать проект соответственно с помощью следующих команд из корня проекта в любой операционной системе с любой системой сборки:

```sh
cmake --preset=dev
cmake --build --preset=dev
ctest --preset=dev
```

Если вы используете совместимый редактор (например, VSCode) или IDE (например, CLion, VS), вы также сможете выбрать созданные выше пользовательские пресеты для автоматической интеграции.

Обратите внимание, что и команды сборки, и команды тестирования принимают флаг `-j` для указания количества используемых заданий, которое в идеале должно быть указано в соответствии с количеством потоков вашего процессора. Вы также можете добавить это в свой пресет, используя свойство `jobs`, более подробную информацию можно найти в [документации по пресетам][1].

### Цели режима разработчика

Это цели, которые вы можете вызвать с помощью приведенной выше команды сборки с дополнительным флагом `-t <target>`:

#### `coverage`

Доступно, если включен `ENABLE_COVERAGE`. Эта цель обрабатывает выходные данные ранее запущенных тестов при построении с конфигурацией покрытия. Команды, которые выполняет эта цель, можно найти в переменных кэша `COVERAGE_TRACE_COMMAND` и `COVERAGE_HTML_COMMAND`. Команда трассировки по умолчанию создает информационный файл, который можно отправить в службы с интеграцией CI. Команда HTML использует выходные данные команды трассировки для создания HTML-документа в `<binary-dir>/coverage_html` по умолчанию.

#### `docs`

Доступно, если включен `BUILD_MCSS_DOCS`. Сборка документации с использованием Doxygen и m.css. По умолчанию вывод будет идти в `<binary-dir>/docs` (настраивается с помощью `DOXYGEN_OUTPUT_DIRECTORY`).

#### `format-check` и `format-fix`

Эти цели запускают инструмент формата clang в базе кода для проверки ошибок и их исправления соответственно. Доступна настройка с использованием переменных кэша `FORMAT_PATTERNS` и `FORMAT_COMMAND`.

#### `run-exe`

Запускает исполняемый целевой файл `CircuitGen_Generator_exe`.

#### `spell-check` и `spell-fix`

Эти цели запускают инструмент кодирования в базе кода для проверки ошибок и их исправления соответственно. Доступна настройка с использованием переменной кэша `SPELL_COMMAND`.

[1]: https://cmake.org/cmake/help/latest/manual/cmake-presets.7.html
[2]: https://cmake.org/download/
